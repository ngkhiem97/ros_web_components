<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/app-route/app-route.html">
<link rel="import" href="../../../bower_components/iron-pages/iron-pages.html">

<dom-module id="mod-turtlebot">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>

        <!-- manages the routes data -->
        <app-route
                route="[[route]]"
                pattern="/:page"
                data="{{routeData}}"
                tail="{{subroute}}">
        </app-route>

        <!-- content -->
        <div class="main-content" id="main-content">
            <iron-pages class="page-content" selected="[[page]]" attr-for-selected="name" selected-attribute="visible" fallback-selection="404">

                <!-- run SLAM control mode -->
                <turtlebot-slam name="slam" route="[[subroute]]"></turtlebot-slam>

                <!-- run Navigation control mode -->
                <turtlebot-navigation name="navigation" route="[[subroute]]"></turtlebot-navigation>
            
                <!-- Not found -->
                <div name="404">
                    <h3>app-bootstrap::Page could not be found!{{page}}</h3>
                </div>
            </iron-pages>
        </div>
    </template>

    <script>
        /**
         * @customElement
         * @polymer
         */
        class ModTurtlebot extends Polymer.Element {
            static get is() { return 'mod-turtlebot'; }
            static get properties() {
                return {
                    page:{
                        type: String,
                        reflectToAttribute: true,
                        observer: '_pageChanged'
                    },
                };
            }
            
            // Resolving page by router URL
            static get observers() {
                return ['_routerChanged(routeData.page)'];
            }
            _routerChanged(page) {
                this.page = page;
            }

            // After successfully resolved page
            _pageChanged(page) {

                if (!this.page || this.page == '404') {
                    return;
                }
                
                // Load page import on demand. Show 404 page if fails
                var resolvedPageUrl = this.resolveUrl('sub-modules/'+this.page+'/turtlebot-'+this.page+'.html');
                Polymer.importHref(
                    resolvedPageUrl,
                    null,
                    this._showPage404.bind(this),
                    true
                );
            }
            _showPage404() {
                this.page = '404';
            }
        }

        window.customElements.define(ModTurtlebot.is, ModTurtlebot);
    </script>
</dom-module>
