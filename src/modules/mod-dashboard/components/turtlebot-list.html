<link rel="import" href="../../../../bower_components/ros-websocket/ros-websocket.html">
<link rel="import" href="../../../../bower_components/ros-topic/ros-topic.html">
<link rel="import" href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">

<!-- Script for data table -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js" charset="utf-8"></script>
<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.16/js/dataTables.bootstrap4.js" charset="utf-8"></script>

<dom-module id="turtlebot-list">
    <template>
        <!-- Bootstrap styling -->
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.16/css/dataTables.bootstrap4.css" rel="stylesheet">

        <style>
            :host {
                display: block;
                font-family: 'Open Sans', sans-serif;
            }
            .list-card {
                margin: 10px;
            }
            paper-button.turtlebot-detail {
                color: white;
                background: #3B3A4D;
            }
            paper-button.turtlebot-connect {
                color: white;
                background: #3B3A4D;
            }
        </style>

        <!-- Connect to ROS Web Socket node -->
        <ros-websocket auto id="ros" ros="{{ros}}" url="{{url}}" on-connection="_handleConnection"
            on-close="_handleClose" on-error="_handleError"></ros-websocket>

        <!-- Register to cmd_vel topic published by turtlebot3_teleop node -->
        <ros-topic id="baseTopic" ros="{{ros}}" topic="cmd_vel" msg-type="geometry_msgs/Twist"></ros-topic>

        <!-- HTML goes here-->
        <div class="card list-card">
            <div class="card-header">
                <i class="fa fa-table"></i> Turtlebot list
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Robot ID
                                <th>Status
                                <th>Connected at
                                <th>Model
                                <th>Detail
                                <th>SLAM
                                <th>Navigation
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>tb_01
                                <td>Available
                                <td>2013-06-23 05:09:12
                                <td>Burger
                                <td>
                                    <paper-button class="turtlebot-detail">Show detail
                                    </paper-button>
                                <td>
                                    <paper-button id="tb_01" class="turtlebot-connect" on-click="_connect">connect
                                    </paper-button>
                                <td>
                                    <paper-button id="tb_03" class="turtlebot-connect" on-click="_connect">connect
                                    </paper-button>
                            </tr>
                            <tr>
                                <td>tb_02
                                <td>Available
                                <td>2013-06-23 05:09:12
                                <td>Burger
                                <td>
                                    <paper-button class="turtlebot-detail">Show detail
                                    </paper-button>
                                <td>
                                    <paper-button id="tb_02" class="turtlebot-connect" on-click="_connect">connect
                                    </paper-button>
                                <td>
                                    <paper-button id="tb_03" class="turtlebot-connect" on-click="_connect">connect
                                    </paper-button>
                            <tr>
                                <td>tb_03
                                <td>Available
                                <td>2013-06-23 05:09:12
                                <td>Burger
                                <td>
                                    <paper-button class="turtlebot-detail">Show detail
                                    </paper-button>
                                <td>
                                    <paper-button id="tb_03" class="turtlebot-connect" on-click="_connect">connect
                                    </paper-button>
                                <td>
                                    <paper-button id="tb_03" class="turtlebot-connect" on-click="_connect">connect
                                    </paper-button>
                            </tr>
                            <tr class="disabled">
                                <td>tb_04
                                <td>Disconnected
                                <td>2013-06-23 05:09:12
                                <td>Burger
                                <td>
                                    <paper-button class="turtlebot-detail">Show detail
                                    </paper-button>
                                <td>
                                <td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
        </div>
    </template>

    <script>
        /**
         * @customElement
         * @polymer
         */
        class TurtlebotList extends Polymer.Element {
            static get is() { return 'turtlebot-list'; }
            static get properties() {
                return {};
            }
            ready() {
                super.ready();
                // Enable datatable js for turtlebot list table
                $(this.$.dataTable).DataTable();
            }
            _connect(e) {
                window.location.href = "/turtlebot/" + e.target.id;
            }
        }
        window.customElements.define(TurtlebotList.is, TurtlebotList);
    </script>
</dom-module>