<link rel="import" href="./../../../bower_components/app-route/app-route.html">
<link rel="import" href="./../../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="./../../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="./components/sidebar-nav.html">

<dom-module id="mod-dashboard">
    <template>
        <style>
            :host {
                display: block;
            }
            paper-toolbar.title-toolbar {
                --paper-toolbar-background: #343a40;
                position: fixed;
                z-index: 9999;
                width: 100%;
            }
            iron-pages.page-content {
                margin-top: 84px;
            }
            .main-content {
                left: 12vw;
                right: 0px;
                position: absolute;
                background: white;
            }
            map-gallery {
                width: 80%;
                margin-top: 1vw;
                margin-left: 1vw;
            }
        </style>

        <!-- manages the routes data -->
        <app-route
                route="[[route]]"
                pattern="/:view"
                data="{{routeData}}">
	    </app-route>

        <!-- side bar for iron-pages navigation -->
        <sidebar-nav id="sidebar-nav"></sidebar-nav>

        <!-- dashboard content -->
        <div class="main-content" id="main-content">
            <paper-toolbar class="title-toolbar">
                <div slot="top" class="title">TurtlebotService > [[dashboardTitle]]</div>
            </paper-toolbar>
            <iron-pages class="page-content" selected="[[view]]" attr-for-selected="name" selected-attribute="visible">

                <!-- display list of available turtlebot -->
                <turtlebot-list name="list"></turtlebot-list>

                <!-- display all the maps scanned by turtlebots -->
                <map-gallery name="maps"></map-gallery>

                <!-- display the information of the ros system -->
                <ros-core name="systems"></ros-core>
            </iron-pages>
        </div>
    </template>
    <script>
        /**
         * @customElement
         * @polymer
         */
        class ModDashboard extends Polymer.Element {
            static get is() { return 'mod-dashboard'; }
            static get properties() {
                return {
                    view:{
                        type: String,
                        observer: '_pageChanged'
                    },
                    dashboardTitle: String,
		            route: Object,
    		        routeData: Object
                };
            }
            constructor() {
                super();
            }
            static get observers(){
                return ['_routerChanged(routeData.view)'];
            }
            _routerChanged(view){
                this.view = view || 'list';
            }
            _pageChanged(view) {
                this.dashboardTitle = view.toUpperCase();

                if (!view) {
                    return;
                }

                var resolvedPageUrl = '';
                // Load page import on demand. Show 404 page if fails
                switch (view) {
                    case 'list':
                        resolvedPageUrl = this.resolveUrl('components/turtlebot-list/turtlebot-list.html');
                        break;
                    case 'maps':
                        resolvedPageUrl = this.resolveUrl('components/map-gallery/map-gallery.html');
                        break;
                    default:
                        resolvedPageUrl = null;
                }
                
                Polymer.importHref(
                    resolvedPageUrl,
                    null,
                    this._showPage404.bind(this),
                    true
                );
            }
            _showPage404() {
                this.page = '404';
            }
        }
        window.customElements.define(ModDashboard.is, ModDashboard);
    </script>
</dom-module>
